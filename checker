import json
import concurrent.futures
import pyfiglet
import os
import pyrubi


# Ø±Ù†Ú¯â€ŒÙ‡Ø§
R = '\033[1;31m'  # Ù‚Ø±Ù…Ø²
G = '\033[1;32m'  # Ø³Ø¨Ø²
Y = '\033[1;33m'  # Ø²Ø±Ø¯
B = '\033[1;34m'  # Ø¢Ø¨ÛŒ ØªÛŒØ±Ù‡
M = '\033[1;35m'  # Ø§Ø±ØºÙˆØ§Ù†ÛŒ ØªÛŒØ±Ù‡
C = '\033[1;36m'  # ÙÛŒØ±ÙˆØ²Ù‡â€ŒØ§ÛŒ ØªÛŒØ±Ù‡
W = '\033[1;37m'  # Ø³ÙÛŒØ¯ ØªÛŒØ±Ù‡
BR = '\033[1;91m' # Ù‚Ø±Ù…Ø² Ø±ÙˆØ´Ù†
BG = '\033[1;92m' # Ø³Ø¨Ø² Ø±ÙˆØ´Ù†
BY = '\033[1;93m' # Ø²Ø±Ø¯ Ø±ÙˆØ´Ù†
BB = '\033[1;94m' # Ø¢Ø¨ÛŒ Ø±ÙˆØ´Ù†
BM = '\033[1;95m' # Ø§Ø±ØºÙˆØ§Ù†ÛŒ Ø±ÙˆØ´Ù†
BC = '\033[1;96m' # ÙÛŒØ±ÙˆØ²Ù‡â€ŒØ§ÛŒ Ø±ÙˆØ´Ù†
BW = '\033[1;97m' # Ø³ÙÛŒØ¯ Ø±ÙˆØ´Ù†
NC = '\033[0m'    # Ø±Ù†Ú¯ Ù¾ÛŒØ´â€ŒÙØ±Ø¶
def imroyd_welcome():
    # Ø®ÙˆØ´â€ŒØ¢Ù…Ø¯Ú¯ÙˆÛŒÛŒ Ø¨Ø§ ASCII art
    imroyd_name = "   IMROYD"
    ascii_art = pyfiglet.figlet_format(imroyd_name, font="slant")
    print(f"{BB}{ascii_art}{NC}")

    imroyd_msg = f"      {BM}Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯Ù‡ ØªÙˆØ³Ø· Ø§Ù…ÛŒØ±ğŸ’{NC}        "
    print(f"{imroyd_msg}{NC}")
    print("\n")

def amir_process(sss):
    # ØªØ§Ø¨Ø¹ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù‡Ø± auth
    try:
        imroyd = pyrubi.Client(auth=sss["auth"], private=sss["malek"], api_version=6, platform='android')
        maj = imroyd.get_me()
        return {
            "sss": sss,
            "phone": maj['user']['phone'],
            "success": True
        }
    except Exception as mao:
        error_message = str(mao)
        if "Incorrect padding" in error_message:
            try:
                fixed_malek = sss["malek"] + "=="
                imroyd = pyrubi.Client(auth=sss["auth"], private=fixed_malek, api_version=6, platform='android')
                maj = imroyd.get_me()
                return {
                    "sss": sss,
                    "phone": maj['user']['phone'],
                    "success": True
                }
            except Exception as mao:
                error_message = str(mao)
        return {
            "sss": sss,
            "error": error_message,
            "success": False
        }

def load_imroyd_auth(file_paths):
    # Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ JSON Ø§Ø² ÙØ§ÛŒÙ„â€ŒÙ‡Ø§
    data = []
    for file_path in file_paths:
        try:
            with open(file_path, "r") as f:
                data.extend(json.load(f))
        except FileNotFoundError:
            print(f"{BR}âœ˜ Ø§ÙˆÙ‡! ÙØ§ÛŒÙ„ {file_path} Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯.{NC}")
        except json.JSONDecodeError:
            print(f"{BR}âœ˜ Ø§ÛŒÙ† ÙØ§ÛŒÙ„ {file_path} Ù…Ø´Ú©Ù„ Ø¯Ø§Ø±Ù‡ Ùˆ Ø¯Ø±Ø³Øª Ø¨Ø§Ø² Ù†Ù…ÛŒØ´Ù‡.{NC}")
    return data

def remove_imroyd_duplicates(max):
    # Ø­Ø°Ù auths ØªÚ©Ø±Ø§Ø±ÛŒ
    seen = set()
    unique_imroyds = []
    for sss in max:
        pair = (sss["auth"], sss["malek"])
        if pair not in seen:
            seen.add(pair)
            unique_imroyds.append(sss)
    return unique_imroyds

def amir_save(sss, mn):
    # Ø°Ø®ÛŒØ±Ù‡ auth Ù‡Ø§ÛŒ Ù…ÙˆÙÙ‚ Ø¯Ø± ÛŒÚ© ÙØ§ÛŒÙ„ Ø¬Ø¯ÛŒØ¯
    try:
        with open(f"/storage/emulated/0/Download/{mn}.json", "w") as f:
            json.dump(sss, f)
        print(f"{BG}âœ” ÙØ§ÛŒÙ„ Ø¨Ø§ Ù†Ø§Ù… {mn}.json Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.{NC}")
    except Exception as mao:
        print(f"{BR}âœ˜ Ù†ØªÙˆÙ†Ø³ØªÙ… ÙØ§ÛŒÙ„ Ø±Ùˆ Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†Ù…. {str(mao)}{NC}")

def list_json_files(directory):
    # Ù„ÛŒØ³Øª Ú©Ø±Ø¯Ù† ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ JSON Ø¯Ø± ÛŒÚ© Ø¯Ø§ÛŒØ±Ú©ØªÙˆØ±ÛŒ
    return [os.path.join(directory, file) for file in os.listdir(directory) if file.endswith(".json")]

def get_file_list(directory):
    # Ù†Ù…Ø§ÛŒØ´ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ø¯Ø± Ø¯Ø§ÛŒØ±Ú©ØªÙˆØ±ÛŒ Ùˆ Ø§Ù†ØªØ®Ø§Ø¨ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§
    json_files = list_json_files(directory)
    
    if not json_files:
        print(f"{BR}âœ˜ Ù‡ÛŒÚ† ÙØ§ÛŒÙ„ JSON ØªÙˆ {directory} Ù¾ÛŒØ¯Ø§ Ù†Ú©Ø±Ø¯Ù….{NC}")
        return []

    print(f"{BY}â¤ Ø§ÛŒÙ†Ø§ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ JSON Ù¾ÛŒØ¯Ø§ Ø´Ø¯Ù‡ ØªÙˆ {directory}:{NC}")
    for i, file_path in enumerate(json_files, 1):
        print(f"{BY}{i}. {file_path}{NC}")

    print(f"{BC}âœ Ø´Ù…Ø§Ø±Ù‡ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒÛŒ Ú©Ù‡ Ù…ÛŒØ®ÙˆØ§ÛŒ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ú©Ù†ÛŒ Ø±Ùˆ Ø¨Ú¯ÙˆØŒ Ø¨Ø§ ÙØ§ØµÙ„Ù‡ Ø¬Ø¯Ø§ Ú©Ù† (Ù…Ø«Ù„ '1 3 5'):{NC}")
    file_numbers = input().strip().split()

    selected_files = []
    for number in file_numbers:
        try:
            index = int(number) - 1
            if 0 <= index < len(json_files):
                selected_files.append(json_files[index])
            else:
                print(f"{BR}âœ˜ Ø´Ù…Ø§Ø±Ù‡ {number} Ù†Ø§Ù…Ø¹ØªØ¨Ø±Ù‡!{NC}")
        except ValueError:
            print(f"{BR}âœ˜ ÙˆØ±ÙˆØ¯ÛŒ {number} Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª.{NC}")

    return selected_files

def main():
    imroyd_welcome()

    # Ø¯Ø§ÛŒØ±Ú©ØªÙˆØ±ÛŒ Ú©Ù‡ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ JSON ØªÙˆØ´ Ù‡Ø³Øª
    directory = "/storage/emulated/0/Download"

    # Ø¯Ø±ÛŒØ§ÙØª Ù„ÛŒØ³Øª ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ Ø§Ø² Ø¯Ø§ÛŒØ±Ú©ØªÙˆØ±ÛŒ
    file_paths = get_file_list(directory)

    if not file_paths:
        print(f"{BR}âœ˜ ÙØ§ÛŒÙ„ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ø´Ø¯.{NC}")
        return

    # Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø­ØªÙˆØ§ÛŒ JSON Ø§Ø² ÙØ§ÛŒÙ„â€ŒÙ‡Ø§
    max = load_imroyd_auth(file_paths)

    if not max:
        print(f"{BR}âœ˜ Ù‡ÛŒÚ† auth Ø¯Ø±Ø³ØªÛŒ ØªÙˆÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ Ù¾ÛŒØ¯Ø§ Ù†Ú©Ø±Ø¯Ù….{NC}")
        return

    # Ø­Ø°Ù Ù…ÙˆØ§Ø±Ø¯ ØªÚ©Ø±Ø§Ø±ÛŒ
    max = remove_imroyd_duplicates(max)
    print(f"{BC}â¤ ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„ auth Ù‡Ø§ÛŒ ÛŒÚ©ØªØ§: {len(max)} {NC}")

    # Ù¾Ø±Ø¯Ø§Ø²Ø´ auths
    sss_success = []
    with concurrent.futures.ThreadPoolExecutor(max_workers=100) as executor:
        futures = [executor.submit(amir_process, sss) for sss in max]

        for future in concurrent.futures.as_completed(futures):
            result = future.result()
            if result["success"]:
                sss_success.append(result["sss"])
                print(f"{BG}âœ” AUTH Ø¯Ø±Ø³Øª: {result['sss']['auth']} \n - Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ†: {result['phone']}{NC}")
            else:
                print(f"{BR}âœ˜ AUTH Ù…Ø´Ú©Ù„â€ŒØ¯Ø§Ø±: {result['sss']['auth']}\n - Ø®Ø·Ø§: {result['error']}{NC}")

    # Ù†Ù…Ø§ÛŒØ´ Ù†ØªÛŒØ¬Ù‡ Ù†Ù‡Ø§ÛŒÛŒ
    print(f"{BM}â–­â–¬â–­â–¬â–­â–¬â–­â–¬â–­â–¬â–­ IMROYD â–¬â–­â–¬â–­â–¬â–­â–¬â–­â–¬â–­{NC}")
    print(f"{BG}âœ” ØªØ¹Ø¯Ø§Ø¯ AUTH Ù‡Ø§ÛŒ Ø¯Ø±Ø³Øª: {len(sss_success)} {NC}")
    print(f"{BR}âœ˜ ØªØ¹Ø¯Ø§Ø¯ AUTH Ù‡Ø§ÛŒ Ù…Ø´Ú©Ù„â€ŒØ¯Ø§Ø±: {len(max) - len(sss_success)} {NC}")

    # Ú¯Ø±ÙØªÙ† Ù†Ø§Ù… ÙØ§ÛŒÙ„ Ø®Ø±ÙˆØ¬ÛŒ Ø§Ø² Ú©Ø§Ø±Ø¨Ø±
    print(f"{BY}âœ ÛŒÙ‡ Ø§Ø³Ù… Ø¨Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ AUTH Ù‡Ø§ÛŒ Ø¯Ø±Ø³Øª:{NC}")
    mn = input().strip()
    if mn:
        amir_save(sss_success, mn)

if __name__ == "__main__":
    main()
